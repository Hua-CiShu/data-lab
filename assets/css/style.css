:root{
  --sidebar:260px;
  --sidebar-compact:150px;
  --radius:6px;
  --controls-h:64px;
  --controls-gap:18px;

  --bg:#ffffff; --surface:#ffffff; --fg:#111827; --muted:#6b7280;
  --primary:#2563eb; --border:#e5e7eb; --table-header:#f8fafc;
  --glass:rgba(255,255,255,.05);
}
:root[data-theme="dark"]{
  --bg:#0f172a; --surface:#0b1222; --fg:#e5e7eb; --muted:#a3aab7;
  --primary:#60a5fa; --border:rgba(255,255,255,.16); --table-header:rgba(255,255,255,.06);
  --glass:rgba(11,18,34,.05);
}

*{ box-sizing:border-box } html,body{ height:100% }
body{
  margin:0; background:var(--bg); color:var(--fg);
  font:15px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Noto Sans SC","Microsoft YaHei",sans-serif;
}

.app{ display:grid; grid-template-columns:var(--sidebar) 1fr; min-height:100vh; }
body.sidebar-compact .app{ grid-template-columns:var(--sidebar-compact) 1fr; }

/* Sidebar */
.sidebar{
  position:sticky; top:0; height:100vh; padding:16px;
  border-right:1px solid var(--border); background:var(--surface);
  display:flex; flex-direction:column; overflow:hidden;
  transition:transform 1.1s cubic-bezier(.22,.7,.18,1), width 1.1s cubic-bezier(.22,.7,.18,1);
}
.brand{ position:relative; display:flex; align-items:center; gap:10px; margin-bottom:12px; }
.brand h1{ margin:0; font-size:18px; font-weight:700; white-space:nowrap }
.brand .badge-dl{
  width:34px; height:34px; border-radius:50%; display:none; align-items:center; justify-content:center;
  font-weight:800; border:1px solid var(--border); background:var(--surface); color:var(--fg);
}
body.sidebar-compact .brand h1{ display:none }
body.sidebar-compact .brand .badge-dl{ display:flex }

#sidebarPin{
  position:absolute; top:50%; right:8px; transform:translateY(-50%);
  z-index:1100; border:1px solid var(--border); background:var(--surface); color:var(--fg);
  padding:6px 10px; border-radius:6px; font-size:12px; line-height:1; cursor:pointer;
}

.nav{ display:flex; flex-direction:column; gap:8px; flex:1; min-width:0 }
.nav-item{ border:1px solid var(--border); border-radius:var(--radius); background:var(--surface); overflow:hidden }
.nav-head{ padding:10px 12px; cursor:pointer; display:flex; align-items:center; justify-content:space-between }
.nav-head .title{ display:flex; align-items:center; gap:8px; min-width:0; width:100% }
.nav-head .title span{ display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.nav-item:hover .nav-head{ background:var(--table-header) }
.submenu{
  border-top:1px solid var(--border); padding:0 8px 0 18px;
  max-height:0; opacity:0; transform:translateY(-2px);
  overflow:hidden; transition:max-height .2s ease, opacity .2s ease, transform .2s ease, padding .2s ease;
}
.nav-item.open .submenu{ padding:6px 8px 10px 18px; max-height:420px; opacity:1; transform:translateY(0) }
.submenu a{ display:block; padding:6px 8px; border-radius:6px; color:inherit; text-decoration:none; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.submenu a:hover{ background:var(--table-header) }
.nav-footer{ margin-top:12px }
.nav-footer .btn.small{ padding:6px 10px; font-size:12px }

/* 主内容对工具组留白（展开时高度 + 间距） */
.main{ padding:18px; padding-top:calc(var(--controls-h) + var(--controls-gap)) !important; }
.card{ background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); padding:16px }
.h{ margin:0 0 8px; font-size:18px; font-weight:600 }
.muted{ color:var(--muted) }

.inline{ display:flex; align-items:center; gap:6px }
.badge,.chip{ border:1px solid var(--border); border-radius:999px; padding:6px 10px; color:var(--muted); background:var(--surface) }
.chip{ padding:2px 8px }
.btn{ appearance:none; border:1px solid var(--border); background:var(--primary); color:#fff; padding:8px 12px; border-radius:var(--radius); cursor:pointer; font-weight:600; box-shadow:none }
.btn.secondary{ background:var(--surface); color:var(--fg) }
.btn.ghost{ background:transparent; color:var(--primary); border-color:transparent }
.btn:hover{ filter:brightness(0.98) }
.btn.sm{ padding:6px 10px; font-size:13px }
input[type=file], select, input, textarea{ border:1px solid var(--border); background:var(--surface); color:var(--fg); padding:8px 10px; border-radius:var(--radius) }

/* 表格 */
table{ width:100%; border-collapse:collapse; font-size:13px; background:var(--surface) }
th,td{ border:1px solid var(--border); padding:6px 8px; text-align:left }
th{ background:var(--table-header) }

/* 悬浮工具组（95% 透明玻璃） */
.controls-wrap{
  position:fixed; top:12px; left:calc(var(--sidebar) + 24px); right:24px; z-index:50;
  pointer-events:none; transition:left .3s ease;
}
body.sidebar-compact .controls-wrap{ left:calc(var(--sidebar-compact) + 24px) }
.controls{
  pointer-events:auto; background:var(--glass);
  backdrop-filter:saturate(120%) blur(10px); -webkit-backdrop-filter:saturate(120%) blur(10px);
  border:1px solid var(--border); border-radius:var(--radius); overflow:hidden;
  transition: transform 1.1s cubic-bezier(.22,.7,.18,1), opacity 1.1s ease, visibility 1.1s;
  transform-origin:right center;
  opacity:.05; /* 95% 透明：显示内容但不突兀 */
}
.controls-row{ display:flex; align-items:center; gap:8px; padding:8px 10px; white-space:nowrap }
.control-toggle.tiny{
  margin-left:auto; border:1px solid var(--border); background:var(--surface); color:var(--fg);
  padding:4px 8px; border-radius:var(--radius); font-size:12px; line-height:1; cursor:pointer;
}
#controlsWrap.is-collapsed .controls{
  transform:perspective(900px) rotateY(-16deg) scaleX(.86) translateX(26%);
  opacity:0; visibility:hidden;
}
/* 右上把手固定坐标，位置不变 */
#controlsHandle{
  position:fixed; top:14px; right:18px; z-index:1200;
  border:1px solid var(--border); background:var(--surface); color:var(--fg);
  padding:6px 10px; border-radius:6px; font-size:12px; line-height:1; cursor:pointer;
}
body:not(.controls-collapsed) #controlsHandle{ opacity:0; pointer-events:none }
body.controls-collapsed      #controlsHandle{ opacity:.95 }

/* 移动端 */
@media (max-width: 900px){
  :root{ --sidebar:0px; --sidebar-compact:0px }
  .app{ grid-template-columns:1fr !important }
  .sidebar{
    position:fixed; top:0; left:0; bottom:0; width:78%; max-width:320px;
    background:var(--surface); transform:translateX(-100%); box-shadow:0 10px 30px rgba(0,0,0,.25);
    transition:transform .35s cubic-bezier(.22,.7,.18,1); z-index:1000;
    overflow:hidden; display:flex; flex-direction:column;
  }
  body.sidebar-open .sidebar{ transform:translateX(0) }
  .drawer-mask{ position:fixed; inset:0; background:rgba(0,0,0,.35); opacity:0; visibility:hidden; transition:opacity .25s ease; z-index:999 }
  body.sidebar-open .drawer-mask{ opacity:1; visibility:visible }
  .controls-wrap{ left:max(12px, env(safe-area-inset-left)); right:max(12px, env(safe-area-inset-right)); top:calc(8px + env(safe-area-inset-top)) }
  .controls-row{ gap:6px; padding:8px }
  .btn, .btn.sm, input, select{ min-height:44px }
  .main{ padding:12px; padding-top:calc(var(--controls-h) + 12px) !important }
  .card{ padding:12px }
  table{ display:block; overflow-x:auto; -webkit-overflow-scrolling:touch }
  thead, tr:first-child{ position:sticky; top:0; z-index:1 }
}

/* 兜底：绝不拦点击（即便有语法问题） */
#controlsWrap{ pointer-events:none !important }
#controlsWrap .controls{ pointer-events:auto !important }
